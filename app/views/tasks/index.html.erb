<% if current_user %>
    <section class="content" data-controller="search">

        <h1>Your Tasks</h1>

          <input type="text" id="search" placeholder="Search..."
          data-action="input->search#filterTasks"/>

        <!-- Filter dropdown form -->
        <%= form_with url: tasks_path, method: :get, local: true do %>
          <%= select_tag :priority,
              options_for_select(
                [
                  ["All Priorities", ""],
                  ["Due Soon", "due_soon"]
                ] + @priorities.map { |p| ["Priority #{p}", p] },
                params[:priority]
              ),
              onchange: 'this.form.submit();',
              class: "form-select mb-4" %>
        <% end %>


      <h3>Open Tasks</h3>
        <div id="tasks">
          <% if @tasks.any? %>
            <%= render partial: "task_card", collection: @tasks, as: :task %>
          <% else %>
            <p>No open tasks at the moment.</p>
          <% end %>
        </div>

      <h3>Completed Tasks</h3>
        <div id="completed_tasks">
          <% if @completed_tasks.any? %>
            <%= render partial: "task_card", collection: @completed_tasks, as: :task, locals: { completed: true } %>
          <% else %>
            <p>No completed tasks yet.</p>
          <% end %>
        </div>
    </section>

  <%else %>
    <h1> Please Sign In </h1>

    <h5> Don't have an account? <%= link_to "Sign Up! :D", signup_path %> </h5>

    <%= form_with(url: session_path) do |f| %>

      <%= f.label :email_or_username %>
      <%= f.text_field :email_or_username, placeholder: 'Please enter your email or username', autofocus: true, required: true %>

      <%= f.label :password %>
      <%= f.password_field :password, required: true %>

      <%= f.submit "Sign In" %>

    <% end %>


<% end %>
