<p>
  <strong>Title:</strong>
  <%= @task.title %>
</p>

<p>
  <strong>Description:</strong>
  <%= @task.description %>
</p>

<p>
  <strong>Due date:</strong>
  <%= @task.due_date %>
</p>

<p>
  <strong>Priority:</strong>
  <%= @task.priority %>
</p>

<p>
  <strong>User:</strong>
  <%= @task.user.name %>
</p>

<p>
  <strong>Completed:</strong>
  <%= @task.is_completed.to_s.capitalize %>
</p>


<div class="mt-3">

  <div class="d-below-1400">
    <div class="dropdown w-100 task-actions">
      <button class="btn btn-primary dropdown-toggle w-100" type="button"
              data-bs-toggle="dropdown" aria-expanded="false">
        Task Actions
      </button>
      <ul class="dropdown-menu w-100">
        <li><%= link_to "Add comment", new_task_comment_path(@task), class: "dropdown-item" %></li>

        <% if current_user %>
          <li><%= link_to "Edit this task", edit_task_path(@task), class: "dropdown-item" %></li>
        <% else %>
          <li><%= link_to "Back to tasks", tasks_path, class: "dropdown-item" %></li>
        <% end %>


        <li>
          <%= link_to "Destroy this task",
              @task,
              data: { turbo_method: :delete, turbo_confirm: "Delete this task?" },
              class: "dropdown-item" %>
        </li>

        <li>
          <%= link_to (@task.is_completed? ? "Mark Incomplete" : "Mark Completed"),
              mark_completed_task_path(@task),
              data: { turbo_method: :patch },
              class: "dropdown-item" %>
        </li>
      </ul>
    </div>
  </div>

<div class="d-above-1400 d-flex flex-wrap gap-2 mt-2">
  <%= link_to "Add Comment", new_task_comment_path(@task),
        class: "btn btn-primary" %>

  <% if current_user %>
    <%= link_to "Edit this task", edit_task_path(@task),
          class: "btn btn-outline-secondary" %>
  <% else %>
    <%= link_to "Back to tasks", tasks_path,
          class: "btn btn-outline-secondary" %>
  <% end %>

  <%= button_to "Destroy this task", @task,
        method: :delete,
        data: { turbo_confirm: "Delete this task?" },
        class: "btn btn-not-completed",
        form_class: "d-inline" %>

  <%= toggle_completion_button(@task,
        class: "btn btn-outline-secondary",
        form_class: "d-inline") %>
</div>

<% if current_user %>
  <h4 class="mt-4">Add a comment</h4>
  <%= form_with model: [@task, Comment.new], local: true do |f| %>
    <div class="mb-2">
      <%= f.text_area :content, rows: 3, class: "form-control", required: true %>
    </div>
    <%= f.submit "Post", class: "btn btn-primary" %>
  <% end %>
<% end %>

<% if @comments.present? %>
  <h3 class="mt-5">Comments</h3>
  <% @comments.each do |comment| %>
    <div class="mt-4 border rounded p-2">
      <div class="small text-muted mb-1">
        <strong><%= comment.user.name %></strong>
        â€¢ <%= time_ago_in_words(comment.created_at) %> ago
      </div>
      <div class="content">
        <%= simple_format(comment.content) %>
      </div>
      <div class="d-flex justify-content-center gap-2">
        <%= button_to "Delete Comment",
            task_comment_path(@task, comment),
            method: :delete,
            class: "btn btn-not-completed btn-sm",
            form_class: "d-inline",
            data: { turbo_confirm: "Delete this comment?" } %>

        <%= button_to "Edit Comment",
            edit_task_comment_path(@task, comment),
            method: :get,
            class: "btn btn-outline-secondary btn-sm",
            form_class: "d-inline" %>
      </div>
    </div>
  <% end %>
<% else %>
  <p class="mt-5 text-muted">No comments yet.</p>
<% end %>
